{% extends "base.html" %}

{% block title %}Authorize â€” EricAuth{% endblock %}

{% block content %}
<h1>Authorize Application</h1>

<p class="consent-info">
    <strong>{{ client_id }}</strong> is requesting access to your account.
</p>

<p class="consent-signed-in">Signed in as <strong>{{ email }}</strong></p>

{% if !scopes.is_empty() %}
<div class="scope-list">
    <p>This application is requesting the following permissions:</p>
    <ul>
        {% for scope in &scopes %}
        <li>{{ scope }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<form method="POST" action="/consent">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="client_id" value="{{ client_id }}">
    {% if let Some(uri) = redirect_uri %}
    <input type="hidden" name="redirect_uri" value="{{ uri }}">
    {% endif %}
    {% if let Some(s) = state %}
    <input type="hidden" name="state" value="{{ s }}">
    {% endif %}
    {% if let Some(sc) = scope_raw %}
    <input type="hidden" name="scope" value="{{ sc }}">
    {% endif %}
    {% if let Some(rt) = response_type %}
    <input type="hidden" name="response_type" value="{{ rt }}">
    {% endif %}
    {% if let Some(cc) = code_challenge %}
    <input type="hidden" name="code_challenge" value="{{ cc }}">
    {% endif %}
    {% if let Some(ccm) = code_challenge_method %}
    <input type="hidden" name="code_challenge_method" value="{{ ccm }}">
    {% endif %}
    {% if let Some(n) = nonce %}
    <input type="hidden" name="nonce" value="{{ n }}">
    {% endif %}

    <input type="hidden" name="action" value="allow">
    <button type="submit" class="btn btn-primary">Allow</button>
</form>

<form method="POST" action="/consent">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="client_id" value="{{ client_id }}">
    {% if let Some(uri) = redirect_uri %}
    <input type="hidden" name="redirect_uri" value="{{ uri }}">
    {% endif %}
    {% if let Some(s) = state %}
    <input type="hidden" name="state" value="{{ s }}">
    {% endif %}

    <input type="hidden" name="action" value="deny">
    <button type="submit" class="btn btn-danger">Deny</button>
</form>
{% endblock %}

{% block head %}
<style>
    .consent-info { margin-bottom: 0.75rem; }
    .consent-signed-in {
        font-size: 0.875rem;
        color: #666;
        margin-bottom: 1rem;
    }
    .scope-list { margin-bottom: 1.5rem; }
    .scope-list p { font-size: 0.875rem; margin-bottom: 0.5rem; }
    .scope-list ul { margin-left: 1.25rem; font-size: 0.875rem; }
    .scope-list li { margin-bottom: 0.25rem; }
</style>
{% endblock %}

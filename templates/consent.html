{% extends "base.html" %}

{% block title %}Authorize â€” EricAuth{% endblock %}

{% block head %}
<style>
    .consent-app {
        font-size: 0.9375rem;
        color: #e4e4e7;
        margin-bottom: 0.5rem;
    }
    .consent-user {
        font-size: 0.8125rem;
        color: #71717a;
        margin-bottom: 1.25rem;
    }
    .scope-list {
        margin-bottom: 1.5rem;
    }
    .scope-label {
        font-size: 0.8125rem;
        color: #a1a1aa;
        margin-bottom: 0.5rem;
    }
    .scope-items {
        list-style: none;
        font-size: 0.8125rem;
    }
    .scope-items li {
        padding: 0.375rem 0;
        color: #d4d4d8;
        border-bottom: 1px solid #25252b;
    }
    .scope-items li:first-child { border-top: 1px solid #25252b; }
</style>
{% endblock %}

{% block content %}
<h1>Authorize application</h1>

<p class="consent-app"><strong>{{ client_id }}</strong> wants to access your account.</p>
<p class="consent-user">Signed in as <strong>{{ email }}</strong></p>

{% if !scopes.is_empty() %}
<div class="scope-list">
    <p class="scope-label">This application will be able to:</p>
    <ul class="scope-items">
        {% for scope in &scopes %}
        <li>
            {% if scope == "openid" %}
            Verify your identity
            {% else if scope == "profile" %}
            View your profile information
            {% else if scope == "email" %}
            View your email address
            {% else %}
            Access: {{ scope }}
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div class="actions">
    <form method="POST" action="/consent">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="client_id" value="{{ client_id }}">
        {% if let Some(uri) = redirect_uri %}
        <input type="hidden" name="redirect_uri" value="{{ uri }}">
        {% endif %}
        {% if let Some(s) = state %}
        <input type="hidden" name="state" value="{{ s }}">
        {% endif %}
        {% if let Some(sc) = scope_raw %}
        <input type="hidden" name="scope" value="{{ sc }}">
        {% endif %}
        {% if let Some(rt) = response_type %}
        <input type="hidden" name="response_type" value="{{ rt }}">
        {% endif %}
        {% if let Some(cc) = code_challenge %}
        <input type="hidden" name="code_challenge" value="{{ cc }}">
        {% endif %}
        {% if let Some(ccm) = code_challenge_method %}
        <input type="hidden" name="code_challenge_method" value="{{ ccm }}">
        {% endif %}
        {% if let Some(n) = nonce %}
        <input type="hidden" name="nonce" value="{{ n }}">
        {% endif %}
        <input type="hidden" name="action" value="allow">
        <button type="submit" class="btn btn-primary">Allow</button>
    </form>

    <form method="POST" action="/consent">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <input type="hidden" name="client_id" value="{{ client_id }}">
        {% if let Some(uri) = redirect_uri %}
        <input type="hidden" name="redirect_uri" value="{{ uri }}">
        {% endif %}
        {% if let Some(s) = state %}
        <input type="hidden" name="state" value="{{ s }}">
        {% endif %}
        <input type="hidden" name="action" value="deny">
        <button type="submit" class="btn btn-secondary">Deny</button>
    </form>
</div>
{% endblock %}
